# AI 权限控制

Operit AI 能够使用工具与您的设备和软件进行交互。为了确保 AI 的所有操作都在您的掌控之下，我们设计了一套灵活的权限系统。您可以精细地调整 AI 在执行不同操作前是否需要寻求您的批准。

## 版本说明

权限系统在 1.6.1 和 1.6.5 版本分别做过较大的调整。为了方便查阅，本文按版本分为三种情况：

-   **1.6.1 之前**：按“全局 / 系统操作”类别控制；
-   **1.6.1 - 1.6.4**：第一代按单个工具控制的权限系统；
-   **1.6.5 及之后**：新版「全局默认 + 单工具例外」权限系统。

---

## 1.6.1 版本之前的权限系统 (按类别控制)

在旧版系统中，权限是按“全局”和“系统操作”这两个类别来控制的。

### 快捷开关：全局自动批准

在对话窗口的设置中，有一个“自动批准”的快捷开关。

![全局自动批准开关](</manuals/assets/permission/image.png>)

-   **开启**：AI 将根据您在设置中配置的权限等级自动执行操作。
-   **关闭**：AI 在执行任何操作前，都会弹出对话框向您请求许可。

这是一个总开关，方便您在不同场景下快速切换。

### 详细权限设置

要进行更精细的配置，请前往“设置” > “数据和权限” > “工具权限设置”。

![工具权限设置入口](</manuals/assets/permission/image2.png>)

在这里，您可以分别设置“全局权限”和“系统操作权限”。

![权限等级配置](</manuals/assets/permission/image3.png>)

#### 权限等级说明

您会看到四个权限等级：

-   **允许 (自动执行)**：最高权限。AI 将自动执行所有操作，不会询问。请在完全信任 AI 时使用。
-   **警惕 (危险操作时询问)**：AI 会自动执行大部分安全操作，但当遇到修改文件、执行高风险命令等操作时，会向您请求确认。
-   **询问 (总是询问)**：最安全的模式。AI 在执行任何操作前，都会请求您的授权。
-   **禁止 (不允许执行)**：完全禁止 AI 使用任何工具。

#### 权限如何生效？

系统的判断逻辑是：**先看总开关，再看具体类别。**

1.  **“全局权限”是总开关。** 如果您将它设置为“询问”或“禁止”，那么所有操作都会被强制“询问”或“禁止”，无论其他设置是什么。

2.  如果“全局权限”设置为“允许”或“警惕”，系统会接着检查操作的具体类别（例如“系统操作权限”），并根据该类别的设置来决定最终行为。

**举个例子：**

如果您这样设置：
-   **全局权限** -> `允许 (自动执行)`
-   **系统操作权限** -> `询问 (总是询问)`

那么：
-   当 AI 执行**普通操作**时，会遵循“全局权限”的`允许`规则，自动执行。
-   当 AI 需要**修改系统设置**时，会遵循“系统操作权限”的`询问`规则，弹出对话框请求您的许可。

---

## 1.6.1 - 1.6.4 版本的权限系统 (按单个工具控制)

这一节仅适用于 1.6.1 - 1.6.4 版本。如果你使用的是 1.6.5 及之后版本，请直接查看下文「1.6.5 及之后的权限系统」一节。

从 1.6.1 版本开始，权限系统升级为“全局权限 + 单个工具例外”的模式，让控制粒度更精细。

### 快捷开关：全局自动批准

与旧版一样，对话窗口中保留了“自动批准”的快捷开关，用于快速开启或关闭所有工具的自动执行权限。

![全局自动批准开关](</manuals/assets/permission/image.png>)

### 详细权限设置

要进行详细配置，请前往“设置” > “数据和权限” > “工具权限设置”。

![工具权限设置入口](</manuals/assets/permission/image2.png>)

### 工具权限管理

新的管理界面如下，您可以设置一个全局规则，并为特定工具添加例外。

![工具权限管理界面](</manuals/assets/permission/a3d6dceea288c5ba84b6b4c78c446caa.jpg>)

#### 全局权限模式

这是适用于所有工具的默认规则：

-   **允许**：自动执行所有工具操作，不询问。
-   **谨慎**：自动执行安全操作，但在执行修改文件、删除内容等高风险操作时会询问。
-   **询问**：**（默认）** 在使用任何工具前都请求您的授权。
-   **禁止**：完全禁止 AI 使用任何工具。

#### 如何配置单个工具的权限？

要理解这个权限系统，最关键的一点是：**所有工具的初始默认状态都是“需要询问”，而全局权限模式决定了如何处理这个状态。**

**核心逻辑：**

-   **全局`询问`、`谨慎`、`禁止`模式**：这些是强制性规则。只要设置为这几种模式，系统就会**忽略**每个工具自身的授权状态，并严格按照全局规则来执行（要么询问，要么禁止）。

-   **全局`允许`模式**：这个模式最特殊。它**不是**“允许所有工具”，而是“**授权系统去检查每个工具自己的许可状态**”。

**用户的授权流程是怎样的？**

如果您希望最终达到让 AI 自动执行大部分操作的目标，您需要这样做：

1.  将 **全局权限模式** 设置为 `允许`。
2.  接下来，当 AI **首次**使用某个工具时（例如 `read_file`），由于该工具的默认状态是“需要询问”，系统依然会**弹出权限请求对话框**。
3.  在这个对话框中，点击 **“以后都允许”**。
4.  完成这一步后，`read_file` 这个工具就获得了您的永久授权。未来在全局`允许`模式下，它将**直接自动执行**，不会再询问。

您需要为您希望自动执行的每一个工具重复第 2 和第 3 步。通过这种方式，您可以逐步建立一个您信任的、可自动执行的工具集。

**总结一下：**

-   想让工具**有可能**被自动执行，**必须**先将全局模式设为 `允许`。
-   在全局`允许`模式下，一个工具**是否真的**会自动执行，取决于您是否已经在它的首次使用弹窗中点击过“以后都允许”。

我们承认这个设计可能与直觉不符，希望以上的解释能帮助您准确地进行配置。

## 1.6.5 及之后的权限系统（全局默认 + 单工具例外）

从 1.6.5 版本开始，权限系统改成了「全局默认 + 单工具例外」的模式，可以理解为两层：

-   **全局默认权限**：给所有工具定一个基础策略；
-   **单工具例外配置**：对少数工具单独指定规则，覆盖全局默认。

最终某个工具执行时用哪种权限，遵循一个简单规则：

> **先看它有没有单独配置；有就用单独配置，没有就用全局默认。**

### 权限等级

新版系统里仍然有四种权限等级（全局和单个工具都用同一套）：

-   **允许（ALLOW）**：直接执行，不再弹窗确认；
-   **谨慎（CAUTION）**：默认自动执行，只在判断为「可能有风险」的操作时弹窗确认；
-   **每次询问（ASK）**：每次调用前都弹窗确认；
-   **禁止（FORBID）**：完全禁止执行，不会调用该工具。

### 全局默认权限

在「工具权限设置」中，你可以先选一个**全局默认权限**，它会作用在**所有没有单独配置的工具**上：

-   比如把全局默认设为 **每次询问（ASK）**，就表示：只要这个工具**没有单独配置**，系统就会在调用前弹窗询问；
-   如果把全局默认设为 **谨慎（CAUTION）**，那这些工具默认会自动执行，只有高风险操作才会弹窗确认；
-   如果把全局默认设为 **禁止（FORBID）**，那所有没有单独配置的工具都不能被调用。

### 单工具例外配置

在同一页面，你会看到四个分组：**允许 / 谨慎 / 每次询问 / 禁止**。你可以把某些工具拖到（或勾选到）对应分组里，为它们设置**例外规则**：

-   把工具放进 **允许** 分组：无论全局默认是什么，这个工具始终自动执行；
-   把工具放进 **谨慎** 分组：这个工具按谨慎策略执行，只在高风险操作时弹窗；
-   把工具放进 **每次询问** 分组：这个工具每次调用都会弹窗确认；
-   把工具放进 **禁止** 分组：这个工具完全禁止调用。

只要工具出现在任意一个分组里，就视为**有单工具例外配置**，会**覆盖**全局默认。

如果你想让某个工具恢复“跟随全局默认”的行为，只需要：

-   在对应分组中再次点击该工具，或
-   在工具选择对话框中取消勾选该工具。

这样就会移除它的例外配置，重新按照全局默认来执行。

### 推荐使用方式

下面是几个常见、比较好理解的配置组合，你可以按自己习惯选择：

-   **整体偏保守，只信任少数工具**  
    - 全局默认：**每次询问（ASK）**；
    - 把完全信任的只读 / 无副作用工具（例如代码搜索、计算器等）加入 **允许（ALLOW）** 分组。  
    效果：大部分工具都会事先询问；只有你明确加入「允许」分组的工具会静默执行。

-   **整体偏自动，仅对高风险操作确认**  
    - 全局默认：**谨慎（CAUTION）**；
    - 把你觉得风险更高的工具（例如修改文件、执行命令等）单独放入 **每次询问（ASK）** 或 **禁止（FORBID）** 分组。  
    效果：普通工具更自动；真正敏感的工具仍然会被单独控制。

-   **极端安全模式，只允许少数白名单工具**  
    - 全局默认：**禁止（FORBID）**；
    - 只把你信任的工具加入对应分组（允许 / 谨慎 / 每次询问）。  
    效果：默认所有工具都被关掉；只有你点名加入分组的工具才会被调用，并按照你为它选定的权限等级执行。

### 1.6.1 及之后通用：权限请求对话框

当 AI 需要执行一个需要您批准的操作时，会弹出如下对话框：

![权限请求对话框](</manuals/assets/permission/60a4d8ccc51c010cedd98dbdf5fd842d.jpg>)

对话框会清晰地列出 AI 想要使用的**工具**、**操作**以及**参数**。您可以选择：

-   **拒绝**：阻止本次操作。
-   **允许**：仅允许本次操作。
-   **以后都允许**：允许本次操作，并将该工具添加到“允许列表”中，未来它将被自动执行。

通过这套权限系统，您可以在便利性与安全性之间找到最适合自己的平衡点。
